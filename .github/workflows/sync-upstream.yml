name: Sync from Web Repo

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM UTC
  workflow_dispatch:  # Manual trigger

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Add upstream remote and fetch
        run: |
          git remote add upstream https://github.com/ChadFarrow/MSP-2.0.git || true
          git fetch upstream

      - name: Check for updates
        id: check
        run: |
          UPSTREAM_COMMITS=$(git rev-list master..upstream/master --count)
          echo "new_commits=$UPSTREAM_COMMITS" >> $GITHUB_OUTPUT

      - name: Merge upstream changes
        if: steps.check.outputs.new_commits != '0'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git merge upstream/master --no-edit

      - name: Create Pull Request
        if: steps.check.outputs.new_commits != '0'
        uses: peter-evans/create-pull-request@v7
        with:
          title: "Sync updates from web repo"
          body: |
            Automated sync from [MSP-2.0 web repo](https://github.com/ChadFarrow/MSP-2.0).

            **New commits:** ${{ steps.check.outputs.new_commits }}

            Review for conflicts in:
            - `package.json`
            - `src/App.tsx`
            - `CLAUDE.md`
          branch: sync-upstream
          delete-branch: true
          labels: automated
